@page "/analytics"
@using JournalApp.Services
@using JournalApp.Data

@* [VIVA INFO]: This page demonstrates 'Data Visualization'. 
   It fetches aggregated data from the AnalyticsService and displays it using MudBlazor components.
*@
<PageTitle>Analytics Studio - Reflecta</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-8 mb-12 analytics-page">
    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <MudAlert Severity="Severity.Error" Variant="Variant.Filled" Class="mb-6 rounded-lg shadow-sm" ShowCloseIcon="true" CloseIconClicked="(() => errorMessage = string.Empty)">
            @errorMessage
        </MudAlert>
    }

    <div class="d-flex align-center justify-space-between mb-8 animate-fade-in">
        <div>
            <MudText Typo="Typo.h3" Class="fw-bold peace-text">Analytics Studio</MudText>
            <MudText Typo="Typo.h6" Class="secondary-text mt-1 opacity-75">Clarity on patterns, moods, and momentum.</MudText>
        </div>
        <div class="insight-controls">
            <MudDateRangePicker @bind-DateRange="_dateRange" Label="üìÖ Insight Timeline" Variant="Variant.Outlined" 
                                Class="insight-pill" MaxDate="@DateTime.Today" Editable="true" />
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="UpdateAnalytics" Class="insight-pill action-pill">
                <span class="pill-icon">üîÑ</span>
                <span>Update Insights</span>
            </MudButton>
        </div>
    </div>

    @if (isLoading)
    {
        <div class="d-flex justify-center align-center" style="height: 50vh;">
            <MudProgressCircular Color="Color.Primary" Indeterminate="true" Size="Size.Large" />
        </div>
    }
    else if (analytics != null)
    {
        <!-- Key Metrics Cards -->
        <MudGrid Class="mb-8 animate-fade-in-up" Style="animation-delay: 0.1s;">
            <MudItem xs="12" sm="6">
                <div class="insight-tile pastel-pink">
                    <div class="tile-header">
                        <div class="tile-icon">üìò</div>
                        <MudText Typo="Typo.subtitle2" Class="tile-label">Journal Entries</MudText>
                    </div>
                    <MudText Typo="Typo.h3" Class="fw-bold">@analytics.TotalEntries</MudText>
                    <MudText Typo="Typo.body2" Class="tile-insight">You‚Äôre steadily building your reflection archive.</MudText>
                </div>
            </MudItem>
            <MudItem xs="12" sm="6">
                <div class="insight-tile pastel-lavender">
                    <div class="tile-header">
                        <div class="tile-icon">‚ö°</div>
                        <MudText Typo="Typo.subtitle2" Class="tile-label">Writing Momentum</MudText>
                    </div>
                    <MudText Typo="Typo.h3" Class="fw-bold">@analytics.CurrentStreak</MudText>
                    <MudText Typo="Typo.body2" Class="tile-insight">You‚Äôre building a consistent habit.</MudText>
                </div>
            </MudItem>
            <MudItem xs="12" sm="6">
                <div class="insight-tile pastel-peach">
                    <div class="tile-header">
                        <div class="tile-icon">üèÜ</div>
                        <MudText Typo="Typo.subtitle2" Class="tile-label">Peak Consistency</MudText>
                    </div>
                    <MudText Typo="Typo.h3" Class="fw-bold">@analytics.LongestStreak</MudText>
                    <MudText Typo="Typo.body2" Class="tile-insight">Your longest streak shows strong commitment.</MudText>
                </div>
            </MudItem>
            <MudItem xs="12" sm="6">
                <div class="insight-tile pastel-mint">
                    <div class="tile-header">
                        <div class="tile-icon">üìù</div>
                        <MudText Typo="Typo.subtitle2" Class="tile-label">Daily Expression Avg</MudText>
                    </div>
                    <MudText Typo="Typo.h3" Class="fw-bold">@((int)analytics.AverageWordCount)</MudText>
                    <MudText Typo="Typo.body2" Class="tile-insight">Your everyday entries show steady depth.</MudText>
                </div>
            </MudItem>
        </MudGrid>

        <MudGrid Spacing="4">
            <!-- Emotional Overview -->
            <MudItem xs="12" md="7">
                <div class="glass pa-8 rounded-xxl shadow-xl h-100">
                    <div class="d-flex align-center justify-space-between mb-6">
                        <div>
                            <MudText Typo="Typo.h5" Class="fw-bold">Emotional Overview</MudText>
                            <MudText Typo="Typo.body2" Color="Color.Secondary" Class="opacity-75">Positive moods appeared most frequently in this period.</MudText>
                        </div>
                        <MudIcon Icon="@Icons.Material.Rounded.AutoGraph" Color="Color.Primary" />
                    </div>

                    <div class="mood-pill-bar">
                        <div class="pill-segment positive" style="width: @analytics.PositiveMoodPercentage%"></div>
                        <div class="pill-segment neutral" style="width: @analytics.NeutralMoodPercentage%"></div>
                        <div class="pill-segment negative" style="width: @analytics.NegativeMoodPercentage%"></div>
                    </div>

                    <div class="mood-legend mt-6">
                        <div class="legend-item">
                            <span class="legend-emoji">üòä</span>
                            <span>Positive</span>
                            <span class="legend-value">@analytics.PositiveMoodPercentage%</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-emoji">üòê</span>
                            <span>Neutral</span>
                            <span class="legend-value">@analytics.NeutralMoodPercentage%</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-emoji">üòî</span>
                            <span>Negative</span>
                            <span class="legend-value">@analytics.NegativeMoodPercentage%</span>
                        </div>
                    </div>
                </div>
            </MudItem>

            <!-- Mood Distribution Insights -->
            <MudItem xs="12" md="5">
                <div class="glass pa-8 rounded-xxl shadow-xl h-100">
                    <div class="d-flex align-center justify-space-between mb-8">
                        <div>
                            <MudText Typo="Typo.h5" Class="fw-bold">Mood Distribution Insights</MudText>
                            <MudText Typo="Typo.body2" Color="Color.Secondary" Class="opacity-75">A quick glance at your emotional mix.</MudText>
                        </div>
                        <MudIcon Icon="@Icons.Material.Rounded.PieChart" Color="Color.Primary" />
                    </div>

                    <div class="mood-chart-grid">
                        <div class="chart-card">
                            <MudText Typo="Typo.subtitle2" Class="fw-bold mb-4">Mood Donut</MudText>
                            <div class="pie-wrap donut">
                                <div class="pie" style="background: conic-gradient(
                                    #9ADBC3 0% @analytics.PositiveMoodPercentage%,
                                    #B9C7F5 @analytics.PositiveMoodPercentage% @(analytics.PositiveMoodPercentage + analytics.NeutralMoodPercentage)%,
                                    #F2B3BC @(analytics.PositiveMoodPercentage + analytics.NeutralMoodPercentage)% 100%);">
                                </div>
                                <div class="pie-center">
                                    <div class="pie-label">Most frequent mood</div>
                                    <div class="pie-total">@(string.IsNullOrWhiteSpace(analytics.MostFrequentMood) ? "No data" : analytics.MostFrequentMood)</div>
                                    <div class="pie-sub">@analytics.MostFrequentMoodCount entries</div>
                                </div>
                            </div>
                            <div class="pie-legend">
                                <span><i class="legend-dot positive"></i>Positive</span>
                                <span><i class="legend-dot neutral"></i>Neutral</span>
                                <span><i class="legend-dot negative"></i>Negative</span>
                            </div>
                        </div>
                    </div>
                </div>
            </MudItem>

            <!-- Writing Activity Timeline -->
            <MudItem xs="12">
                <div class="glass pa-8 rounded-xxl shadow-xl">
                    @{ var maxWordCount = analytics.DailyWordCounts != null && analytics.DailyWordCounts.Any() ? analytics.DailyWordCounts.Max(d => d.Value) : 0; }
                    <div class="d-flex align-center justify-space-between mb-8">
                        <div>
                            <MudText Typo="Typo.h5" Class="fw-bold">Writing Activity Timeline</MudText>
                            <MudText Typo="Typo.body2" Color="Color.Secondary" Class="opacity-75">
                                @(maxWordCount > 0 ? $"Your most expressive day had {maxWordCount} words." : "No writing activity yet in this range.")
                            </MudText>
                        </div>
                        <MudIcon Icon="@Icons.Material.Rounded.Timeline" Color="Color.Primary" />
                    </div>
                    
                    @if (analytics.DailyWordCounts != null && analytics.DailyWordCounts.Any())
                    {
                        <div class="activity-chart">
                            @foreach (var daily in analytics.DailyWordCounts.OrderByDescending(d => d.Key).Take(7))
                            {
                                var percent = maxWordCount == 0 ? 0 : (daily.Value / (double)maxWordCount) * 100;
                                <div class="activity-row">
                                    <div class="activity-meta">
                                        <MudText Typo="Typo.body2" Class="fw-bold">@daily.Key.ToString("MMM dd")</MudText>
                                        <MudText Typo="Typo.caption" Class="opacity-60">@daily.Value words</MudText>
                                    </div>
                                    <div class="activity-bar">
                                        <span class="activity-fill @(daily.Value == maxWordCount ? "peak" : "")" style="width: @percent%"></span>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <MudText Typo="Typo.body2" Class="opacity-50 text-center py-8">No writing data for this range.</MudText>
                    }
                </div>
            </MudItem>

            <!-- Reflection Topics -->
            <MudItem xs="12">
                <div class="glass pa-8 rounded-xxl shadow-xl">
                    <div class="d-flex align-center justify-space-between mb-8">
                        <div>
                            <MudText Typo="Typo.h5" Class="fw-bold">Reflection Topics</MudText>
                            <MudText Typo="Typo.body2" Color="Color.Secondary" Class="opacity-75">Career-related reflections appeared most often.</MudText>
                        </div>
                        <MudIcon Icon="@Icons.Material.Rounded.Tag" Color="Color.Primary" />
                    </div>

                    @if (analytics.TagUsageCount.Any())
                    {
                        <div class="topic-chips">
                            @foreach (var tag in analytics.TagUsageCount.Take(20))
                            {
                                var percentage = analytics.TagPercentages.ContainsKey(tag.Key) ? analytics.TagPercentages[tag.Key] : 0;
                                <MudTooltip Text="@($"{tag.Value} mentions ‚Ä¢ {percentage}% of total tags")">
                                    <span class="topic-chip @(tag.Value > 10 ? "major" : (tag.Value > 5 ? "medium" : "minor"))">#@tag.Key</span>
                                </MudTooltip>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="py-12 text-center opacity-50">
                            <MudIcon Icon="@Icons.Material.Rounded.LocalOffer" Size="Size.Large" Class="mb-4" />
                            <MudText Typo="Typo.body1">No themes yet. Add tags to reveal patterns.</MudText>
                        </div>
                    }
                </div>
            </MudItem>
        </MudGrid>
    }
</MudContainer>

<style>
    .fw-bold { font-weight: 800 !important; }
    .opacity-75 { opacity: 0.75; }
    .uppercase-tracking { text-transform: uppercase; letter-spacing: 0.05em; font-size: 0.75rem; }
    
    .primary-gradient-text {
        background: linear-gradient(135deg, var(--mud-palette-primary) 0%, var(--mud-palette-secondary) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .metric-card {
        padding: 1.5rem;
        border-radius: 1rem;
        clip-path: polygon(12px 0, 100% 0, 100% calc(100% - 12px), calc(100% - 12px) 100%, 0 100%, 0 12px);
        position: relative;
        overflow: hidden;
        color: #2A2F33;
        min-height: 140px;
        display: flex;
        align-items: center;
        box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(255,255,255,0.1);
    }
    
    .metric-card:hover { 
        transform: translateY(-6px);
        box-shadow: 0 14px 24px -10px rgba(0,0,0,0.12);
        border-color: rgba(var(--mud-palette-primary-rgb), 0.45);
        outline: 1px solid rgba(var(--mud-palette-secondary-rgb), 0.35);
    }


    .peace-card { background: linear-gradient(135deg, #6BBF9E 0%, #94D6D2 100%); }
    .serenity-card { background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%); }
    .success-fade-card { background: linear-gradient(135deg, #86C5C2 0%, #6BBF9E 100%); }
    .info-fade-card { background: linear-gradient(135deg, #F2C1A3 0%, #E9B86F 100%); }

    .metric-content { position: relative; z-index: 2; }
    
    .metric-icon {
        position: absolute;
        bottom: -10px;
        right: -10px;
        font-size: 100px !important;
        opacity: 0.18;
        transform: rotate(-10deg);
        z-index: 1;
    }

    .metric-card .mud-typography { color: inherit; }

    .vibrant-gradient-blue {
        background: linear-gradient(135deg, #F3EEFF 0%, #E9F3FF 100%) !important;
        border: 1px solid #E7E1D8 !important;
    }
    .vibrant-gradient-coral {
        background: linear-gradient(135deg, #FFF1EA 0%, #FFF7ED 100%) !important;
        border: 1px solid #E7E1D8 !important;
    }
    .vibrant-gradient-success {
        background: linear-gradient(135deg, #EAF9F4 0%, #F2F9F7 100%) !important;
        border: 1px solid #E7E1D8 !important;
    }
    [data-theme="Dark"] .metric-card { color: #F5F0E9; }
    [data-theme="Dark"] .vibrant-gradient-blue {
        background: linear-gradient(135deg, rgba(214,199,255,0.15) 0%, rgba(163,201,246,0.12) 100%) !important;
        border: 1px solid rgba(255,255,255,0.06) !important;
    }
    [data-theme="Dark"] .vibrant-gradient-coral {
        background: linear-gradient(135deg, rgba(244,195,174,0.18) 0%, rgba(240,207,157,0.12) 100%) !important;
        border: 1px solid rgba(255,255,255,0.06) !important;
    }
    [data-theme="Dark"] .vibrant-gradient-success {
        background: linear-gradient(135deg, rgba(147,215,196,0.18) 0%, rgba(124,201,176,0.12) 100%) !important;
        border: 1px solid rgba(255,255,255,0.06) !important;
    }

    .mood-chart-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
    }
    .chart-card {
        background: rgba(var(--mud-palette-surface-rgb), 0.6);
        border: 1px solid rgba(var(--mud-palette-divider-rgb), 0.08);
        border-radius: 16px;
        padding: 16px;
    }
    .pie-wrap {
        position: relative;
        width: 180px;
        height: 180px;
        margin: 8px auto 16px;
    }
    .pie {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        box-shadow: inset 0 0 0 12px rgba(var(--mud-palette-surface-rgb), 0.9);
    }
    .pie-center {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }
    .pie-total { font-size: 22px; font-weight: 800; }
    .pie-label { font-size: 12px; color: var(--mud-palette-text-secondary); }
    .pie-legend { display: flex; gap: 12px; justify-content: center; font-size: 12px; color: var(--mud-palette-text-secondary); }
    .pie-legend .legend-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 6px; }
    .pie-legend .legend-dot.positive { background: #7CC9B0; }
    .pie-legend .legend-dot.neutral { background: #A2B5F2; }
    .pie-legend .legend-dot.negative { background: #E8929F; }

    .frequent-mood {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        margin-bottom: 12px;
        border-radius: 12px;
        background: rgba(var(--mud-palette-primary-rgb), 0.06);
        border: 1px solid rgba(var(--mud-palette-divider-rgb), 0.08);
        font-size: 0.85rem;
    }
    .frequent-mood .label { color: var(--mud-palette-text-secondary); font-weight: 600; }
    .frequent-mood .value { color: var(--mud-palette-primary); font-weight: 700; }
    .frequent-mood .count { color: var(--mud-palette-text-secondary); font-weight: 600; }

    .streak-fire {
        font-size: 2rem;
        filter: drop-shadow(0 0 8px rgba(255,165,0,0.5));
        animation: pulse 2s infinite;
    }

    .mood-emoji { font-size: 1.5rem; }
    .shadow-inner { box-shadow: inset 0 2px 4px 0 rgba(0,0,0,0.06); }

    .insight-row {
        display: flex;
        align-items: center;
        gap: 1.25rem;
        padding: 1.25rem;
        border-radius: 1.25rem;
        background: rgba(var(--mud-palette-surface-rgb), 0.05);
        border: 1px solid rgba(var(--mud-palette-divider-rgb), 0.1);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .insight-row:hover { 
        background: rgba(var(--mud-palette-surface-rgb), 0.1); 
        border-color: var(--mud-palette-primary);
        transform: translateX(5px);
    }
    .insight-row .mud-icon-root { font-size: 24px !important; color: #6B7C93; }
    .insight-row.primary .mud-icon-root { color: var(--primary-color); }
    .insight-row.secondary .mud-icon-root { color: #86C5C2; }
    .insight-row.info .mud-icon-root { color: var(--primary-hover); }
    .insight-row.warning .mud-icon-root { color: #E9B86F; }

    .modern-chip-premium {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 18px;
        border-radius: 50px;
        font-weight: 700;
        font-size: 0.9rem;
        background: rgba(var(--mud-palette-surface-rgb), 0.05);
        color: var(--mud-palette-text-primary);
        border: 1px solid rgba(var(--mud-palette-divider-rgb), 0.2);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
    }
    .modern-chip-premium:hover { 
        transform: scale(1.1); 
        background: var(--mud-palette-primary); 
        color: white;
        border-color: transparent;
    }
    .modern-chip-premium.major { 
        background: rgba(255, 105, 180, 0.12); 
        color: var(--primary-color); 
        border: 1px solid rgba(255, 105, 180, 0.3); 
    }
    .tag-count { font-size: 0.75rem; opacity: 0.7; background: rgba(0,0,0,0.05); padding: 2px 8px; border-radius: 8px; }

    .glass {
        backdrop-filter: blur(10px);
        background: rgba(var(--mud-palette-surface-rgb), 0.8) !important;
        border: 1px solid rgba(var(--mud-palette-divider-rgb), 0.05) !important;
    }

    .glass-inner {
        background: rgba(var(--mud-palette-surface-rgb), 0.5) !important;
        border: 1px solid rgba(var(--mud-palette-divider-rgb), 0.05) !important;
    }

    .rounded-xxl { border-radius: 2rem; }
    .shadow-primary { box-shadow: 0 10px 15px -3px rgba(var(--mud-palette-primary-rgb), 0.3); }

    @@keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    @@keyframes fade-in-up {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fade-in-up 0.6s ease-out forwards; }
    .animate-fade-in-up { animation: fade-in-up 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }

    .insight-controls {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    }
    .insight-pill {
        border-radius: 999px !important;
        background: rgba(255, 255, 255, 0.9) !important;
        box-shadow: 0 8px 20px -12px rgba(31, 42, 55, 0.25) !important;
        border: none !important;
        padding: 6px 14px !important;
    }
    .insight-pill .mud-input-outlined-border { border: none !important; }
    .insight-pill .mud-input-root { border-radius: 999px !important; }
    .action-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 18px !important;
    }
    .pill-icon { font-size: 1rem; }

    .insight-tile {
        padding: 1.5rem;
        border-radius: 20px;
        box-shadow: 0 16px 30px -18px rgba(0, 0, 0, 0.25);
        display: flex;
        flex-direction: column;
        gap: 8px;
        min-height: 150px;
        border: 1px solid rgba(255, 255, 255, 0.6);
    }
    .tile-header {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .tile-icon {
        width: 36px;
        height: 36px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.65);
        font-size: 1.1rem;
    }
    .tile-label { letter-spacing: 0.04em; font-weight: 700; opacity: 0.75; }
    .tile-insight { opacity: 0.7; }
    .pastel-pink { background: linear-gradient(135deg, #FFE6F3 0%, #FFF2F8 100%); }
    .pastel-lavender { background: linear-gradient(135deg, #EEF0FF 0%, #F7F8FF 100%); }
    .pastel-peach { background: linear-gradient(135deg, #FFEBD9 0%, #FFF4EA 100%); }
    .pastel-mint { background: linear-gradient(135deg, #E8FBF5 0%, #F1FFFB 100%); }

    .mood-pill-bar {
        height: 16px;
        border-radius: 999px;
        background: #F3F4F6;
        overflow: hidden;
        display: flex;
        box-shadow: inset 0 1px 2px rgba(0,0,0,0.08);
    }
    .pill-segment { height: 100%; }
    .pill-segment.positive { background: linear-gradient(90deg, #9ADBC3, #BCEBDD); }
    .pill-segment.neutral { background: linear-gradient(90deg, #B9C7F5, #D3DCFB); }
    .pill-segment.negative { background: linear-gradient(90deg, #F2B3BC, #F8CBD1); }
    .mood-legend {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
        font-size: 0.9rem;
    }
    .mood-legend .legend-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        padding: 10px 12px;
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.7);
    }
    .legend-emoji { font-size: 1rem; }
    .legend-value { font-weight: 700; }

    .pie-wrap.donut { position: relative; animation: donut-in 0.6s ease-out; }
    .pie-wrap.donut .pie {
        width: 170px;
        height: 170px;
        border-radius: 50%;
        margin: 0 auto;
        transform: scale(0.98);
        transition: transform 0.4s ease;
        box-shadow: none;
    }
    .pie-wrap.donut .pie-center {
        position: absolute;
        inset: 24px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.95);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 12px;
        box-shadow: inset 0 0 0 1px rgba(0,0,0,0.04);
    }
    .pie-center .pie-label { font-size: 0.75rem; opacity: 0.7; }
    .pie-center .pie-total { font-weight: 800; font-size: 1rem; }
    .pie-center .pie-sub { font-size: 0.7rem; opacity: 0.6; }
    @@keyframes donut-in {
        from { opacity: 0; transform: translateY(6px) scale(0.96); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .activity-chart {
        display: grid;
        gap: 12px;
    }
    .activity-row {
        display: grid;
        grid-template-columns: 90px 1fr;
        gap: 16px;
        align-items: center;
    }
    .activity-meta { display: flex; flex-direction: column; gap: 2px; }
    .activity-bar {
        height: 12px;
        background: #F1F3F5;
        border-radius: 999px;
        overflow: hidden;
    }
    .activity-fill {
        display: block;
        height: 100%;
        background: linear-gradient(90deg, rgba(255, 105, 180, 0.4), rgba(255, 105, 180, 0.75));
        border-radius: 999px;
    }
    .activity-fill.peak {
        background: linear-gradient(90deg, rgba(255, 105, 180, 0.65), rgba(255, 105, 180, 0.95));
        box-shadow: 0 6px 14px -8px rgba(255, 105, 180, 0.9);
    }

    .topic-chips {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .topic-chip {
        padding: 8px 14px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.9);
        font-weight: 600;
        font-size: 0.85rem;
        box-shadow: 0 8px 18px -14px rgba(0,0,0,0.25);
        border: 1px solid rgba(0,0,0,0.04);
    }
    .topic-chip.major { background: linear-gradient(135deg, #FFE6F3, #FFF2F8); }
    .topic-chip.medium { background: linear-gradient(135deg, #E8FBF5, #F1FFFB); }
    .topic-chip.minor { background: linear-gradient(135deg, #EEF0FF, #F7F8FF); }
</style>

